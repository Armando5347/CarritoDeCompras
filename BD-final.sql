-- MySQL Script generated by MySQL Workbench
-- Fri May 29 22:31:07 2020
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `mydb` ;

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `mydb` DEFAULT CHARACTER SET utf8 ;
-- -----------------------------------------------------
-- Schema carritocompras
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `carritocompras` ;

-- -----------------------------------------------------
-- Schema carritocompras
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `carritocompras` DEFAULT CHARACTER SET utf8 ;
USE `mydb` ;
USE `carritocompras` ;

-- -----------------------------------------------------
-- Table `carritocompras`.`caromas`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`caromas` (
  `ID` INT(11) NOT NULL,
  `aroma` VARCHAR(20) NULL DEFAULT NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `carritocompras`.`chojasxrollo`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`chojasxrollo` (
  `ID` INT(11) NOT NULL,
  `no_hojas` INT(11) NULL DEFAULT NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `carritocompras`.`cliente`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`cliente` (
  `ID_cli` INT(11) NOT NULL AUTO_INCREMENT,
  `nombre_cli` VARCHAR(45) NOT NULL,
  `appat_cli` VARCHAR(45) NOT NULL,
  `apmat_cli` VARCHAR(45) NOT NULL,
  `fecha_nacimiento_cli` DATE NULL DEFAULT NULL,
  `username_cli` VARCHAR(20) NOT NULL,
  `password_cli` VARCHAR(20) NOT NULL,
  `cel_cli` INT(11) NULL DEFAULT NULL,
  `tel_cli` BIGINT(12) NULL DEFAULT NULL,
  PRIMARY KEY (`ID_cli`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `carritocompras`.`cmaterial`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`cmaterial` (
  `ID` INT(11) NOT NULL,
  `Material` VARCHAR(20) NULL DEFAULT NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `carritocompras`.`mcarritocompras`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`mcarritocompras` (
  `ID` INT(11) NOT NULL AUTO_INCREMENT,
  `orden` VARCHAR(45) NULL DEFAULT NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `carritocompras`.`mpapel`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`mpapel` (
  `ID_mp` INT(11) NOT NULL AUTO_INCREMENT,
  `Nombre_producto` VARCHAR(45) NULL DEFAULT NULL,
  `id_DPapel` INT(11) NOT NULL,
  PRIMARY KEY (`ID_mp`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `carritocompras`.`dcarritodecompras`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`dcarritodecompras` (
  `ID` INT(11) NOT NULL,
  `total` DOUBLE NULL DEFAULT NULL,
  `Subtotal` DOUBLE NULL DEFAULT NULL,
  `MPapel_ID` INT(11) NOT NULL,
  `MCarritoCompras_ID` INT(11) NOT NULL,
  PRIMARY KEY (`ID`),
  INDEX `fk_DCarritoDeCompras_MPapel1_idx` (`MPapel_ID` ASC) ,
  INDEX `fk_DCarritoDeCompras_MCarritoCompras1_idx` (`MCarritoCompras_ID` ASC) ,
  CONSTRAINT `fk_DCarritoDeCompras_MCarritoCompras1`
    FOREIGN KEY (`MCarritoCompras_ID`)
    REFERENCES `carritocompras`.`mcarritocompras` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_DCarritoDeCompras_MPapel1`
    FOREIGN KEY (`MPapel_ID`)
    REFERENCES `carritocompras`.`mpapel` (`ID_mp`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `carritocompras`.`Dcompracliente`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`Dcompracliente` (
  `ID` INT(11) NOT NULL,
  `DCarritoDeCompras_ID` INT(11) NOT NULL,
  `cliente_ID_cli` INT(11) NOT NULL,
  `fecha` DATE NULL,
  PRIMARY KEY (`ID`),
  INDEX `fk_CompraCliente_DCarritoDeCompras1_idx` (`DCarritoDeCompras_ID` ASC),
  INDEX `fk_compracliente_cliente1_idx` (`cliente_ID_cli` ASC) ,
  CONSTRAINT `fk_CompraCliente_DCarritoDeCompras1`
    FOREIGN KEY (`DCarritoDeCompras_ID`)
    REFERENCES `carritocompras`.`dcarritodecompras` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_compracliente_cliente1`
    FOREIGN KEY (`cliente_ID_cli`)
    REFERENCES `carritocompras`.`cliente` (`ID_cli`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `carritocompras`.`cordenservicio`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`cordenservicio` (
  `ID` INT(11) NOT NULL,
  `tipo_orden` VARCHAR(45) NULL DEFAULT NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `carritocompras`.`cprivilegio_empleado`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`cprivilegio_empleado` (
  `ID` INT(11) NOT NULL,
  `tipo_privilegio` VARCHAR(10) NULL DEFAULT NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `carritocompras`.`crollosincluidos`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`crollosincluidos` (
  `ID` INT(11) NOT NULL,
  `rollos` INT(11) NOT NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `carritocompras`.`ctipo_hojas`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`ctipo_hojas` (
  `ID` INT(11) NOT NULL,
  `tipo_hojas` VARCHAR(10) NOT NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `carritocompras`.`ctipos`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`ctipos` (
  `ID` INT(11) NOT NULL,
  `Tipos` VARCHAR(20) NULL DEFAULT NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `carritocompras`.`empleado`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`empleado` (
  `ID_em` INT(11) NOT NULL AUTO_INCREMENT,
  `nombre_em` VARCHAR(45) NOT NULL,
  `Appat_em` VARCHAR(45) NOT NULL,
  `Apmat_em` VARCHAR(45) NOT NULL,
  `fecha_nacimiento_em` DATE NULL DEFAULT NULL,
  `cel_em` INT(11) NULL DEFAULT NULL,
  `tel_em` BIGINT(12) NULL DEFAULT NULL,
  `username_em` VARCHAR(20) NOT NULL,
  `password_em` VARCHAR(20) NOT NULL,
  `CPrivilegio_Empleado_ID` INT(11) NOT NULL,
  PRIMARY KEY (`ID_em`),
  INDEX `fk_Empleado_CPrivilegio_Empleado1_idx` (`CPrivilegio_Empleado_ID` ASC),
  CONSTRAINT `fk_Empleado_CPrivilegio_Empleado1`
    FOREIGN KEY (`CPrivilegio_Empleado_ID`)
    REFERENCES `carritocompras`.`cprivilegio_empleado` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `carritocompras`.`dordenservicio`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`dordenservicio` (
  `ID` INT(11) NOT NULL,
  `descripcion` LONGTEXT NULL DEFAULT NULL,
  `Cliente_ID` INT(11) NOT NULL,
  `fecha` DATE NULL DEFAULT NULL,
  `Empleado_ID` INT(11) NOT NULL,
  `COrdenServicio_ID` INT(11) NOT NULL,
  PRIMARY KEY (`ID`),
  INDEX `fk_DOrdenServicio_Cliente1_idx` (`Cliente_ID` ASC),
  INDEX `fk_DOrdenServicio_Empleado1_idx` (`Empleado_ID` ASC),
  INDEX `fk_DOrdenServicio_COrdenServicio1_idx` (`COrdenServicio_ID` ASC),
  CONSTRAINT `fk_DOrdenServicio_COrdenServicio1`
    FOREIGN KEY (`COrdenServicio_ID`)
    REFERENCES `carritocompras`.`cordenservicio` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_DOrdenServicio_Cliente1`
    FOREIGN KEY (`Cliente_ID`)
    REFERENCES `carritocompras`.`cliente` (`ID_cli`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_DOrdenServicio_Empleado1`
    FOREIGN KEY (`Empleado_ID`)
    REFERENCES `carritocompras`.`empleado` (`ID_em`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `carritocompras`.`dpapel`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`dpapel` (
  `ID_dp` INT(11) NOT NULL AUTO_INCREMENT,
  `Precio` DOUBLE NOT NULL,
  `Stock` INT(11) NOT NULL,
  `CMaterial_ID` INT(11) NOT NULL,
  `CTipos_ID` INT(11) NOT NULL,
  `Aromas_ID` INT(11) NOT NULL,
  `CRollosIncluidos_ID` INT(11) NOT NULL,
  `CTipo_Hojas_ID` INT(11) NOT NULL,
  `CHojasxRollo_ID` INT(11) NOT NULL,
  PRIMARY KEY (`ID_dp`),
  INDEX `fk_Papel_CMaterial` (`CMaterial_ID` ASC) ,
  INDEX `fk_Papel_CTipos1` (`CTipos_ID` ASC) ,
  INDEX `fk_DPapel_Aromas1` (`Aromas_ID` ASC) ,
  INDEX `fk_DPapel_CRollosIncluidos1` (`CRollosIncluidos_ID` ASC) ,
  INDEX `fk_DPapel_CTipo_Hojas1` (`CTipo_Hojas_ID` ASC),
  INDEX `fk_DPapel_CHojasxRollo1` (`CHojasxRollo_ID` ASC) ,
  CONSTRAINT `fk_DPapel_Aromas1`
    FOREIGN KEY (`Aromas_ID`)
    REFERENCES `carritocompras`.`caromas` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_DPapel_CHojasxRollo1`
    FOREIGN KEY (`CHojasxRollo_ID`)
    REFERENCES `carritocompras`.`chojasxrollo` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_DPapel_CRollosIncluidos1`
    FOREIGN KEY (`CRollosIncluidos_ID`)
    REFERENCES `carritocompras`.`crollosincluidos` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_DPapel_CTipo_Hojas1`
    FOREIGN KEY (`CTipo_Hojas_ID`)
    REFERENCES `carritocompras`.`ctipo_hojas` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_DPapel_MPapel1`
    FOREIGN KEY (`ID_dp`)
    REFERENCES `carritocompras`.`mpapel` (`ID_mp`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Papel_CMaterial`
    FOREIGN KEY (`CMaterial_ID`)
    REFERENCES `carritocompras`.`cmaterial` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Papel_CTipos1`
    FOREIGN KEY (`CTipos_ID`)
    REFERENCES `carritocompras`.`ctipos` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `carritocompras`.`motrdenservicio`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`motrdenservicio` (
  `ID` INT(11) NOT NULL,
  `DOrdenServicio_ID` INT(11) NOT NULL,
  PRIMARY KEY (`ID`),
  INDEX `fk_MOtrdenServicio_DOrdenServicio1_idx` (`DOrdenServicio_ID` ASC),
  CONSTRAINT `fk_MOtrdenServicio_DOrdenServicio1`
    FOREIGN KEY (`DOrdenServicio_ID`)
    REFERENCES `carritocompras`.`dordenservicio` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `carritocompras`.`Dhistorial`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`Dhistorial` (
  `id_Dhistorial` INT NOT NULL AUTO_INCREMENT,
  `Dcompracliente_ID` INT(11) NOT NULL,
  PRIMARY KEY (`id_Dhistorial`),
  INDEX `fk_Dhistorial_Dcompracliente1_idx` (`Dcompracliente_ID` ASC),
  CONSTRAINT `fk_Dhistorial_Dcompracliente1`
    FOREIGN KEY (`Dcompracliente_ID`)
    REFERENCES `carritocompras`.`Dcompracliente` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

USE `carritocompras` ;

-- -----------------------------------------------------
-- procedure establecerTendencia
-- -----------------------------------------------------

DELIMITER $$
USE `carritocompras`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `establecerTendencia`(cantidad int, marca varchar(45), tipo varchar(45))
select unidades, marca from tendencias
where marca = marca$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure traducirIdesCatalogosCarrito
-- -----------------------------------------------------

DELIMITER $$
USE `carritocompras`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `traducirIdesCatalogosCarrito`(id_material int, id_tipos int, id_aroma int, id_rollos int, id_tipo_hojas int, id_hojas_rollos int)
select carritocompras.CMaterial.material, carritocompras.CTipos.Tipos, carritocompras.CAromas.Aroma, carritocompras.CRollosIncluidos.rollos, carritocompras.CTipo_Hojas.tipo_hojas, carritocompras.CHojasxRollo.no_hojas 
    from carritocompras.CMaterial, carritocompras.CTipos, carritocompras.CAromas, carritocompras.CRollosIncluidos, carritocompras.CTipo_Hojas,carritocompras.CHojasxRollo
    where carritocompras.CMaterial.ID = id_material AND
		carritocompras.CTipos.ID = id_tipos AND
        carritocompras.CAromas.ID = id_aroma AND
        carritocompras.CRollosIncluidos.ID = id_rollos AND
        carritocompras.CTipo_Hojas.ID = id_tipo_hojas AND
        carritocompras.CHojasxRollo.ID = id_hojas_rollos$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure traducirValoresCatalogosCarrito
-- -----------------------------------------------------

DELIMITER $$
USE `carritocompras`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `traducirValoresCatalogosCarrito`(mat varchar(20), tipo varchar(20), ar varchar(20), n_rollos int , tip_hojas varchar(10), hojas_rollos int)
select carritocompras.CMaterial.ID, carritocompras.CTipos.ID, carritocompras.CAromas.ID, carritocompras.CRollosIncluidos.ID, carritocompras.CTipo_Hojas.ID, carritocompras.CHojasxRollo.ID 
    from carritocompras.CMaterial, carritocompras.CTipos, carritocompras.CAromas, carritocompras.CRollosIncluidos, carritocompras.CTipo_Hojas,carritocompras.CHojasxRollo
    where carritocompras.CMaterial.material = mat AND
		carritocompras.CTipos.Tipos = tipo AND
        carritocompras.CAromas.Aroma = ar AND
        carritocompras.CRollosIncluidos.rollos = n_rollos AND
        carritocompras.CTipo_Hojas.tipo_hojas = tip_hojas AND
        carritocompras.CHojasxRollo.no_hojas = hojas_rollos$$

DELIMITER ;

insert into carritocompras.CMaterial (ID, Material) values(1, "CELULOSA"),(2,"FIBRA VEGETAL");

insert into carritocompras.CAromas (ID, Aroma) values(1, "SIN AROMA"),(2,"ALMENDRAS");

insert into carritocompras.CTipos (ID, Tipos) values(1, "Residencial"),(2,"Institucional");

insert into carritocompras.CRollosIncluidos (ID, rollos) values(1, 4), (2, 12), (3,18), (4,24), (5,32);

insert into carritocompras.CTipo_Hojas (ID, tipo_hojas) values(1, "Doble"),(2, "Triple"),(3,"Cuadruple");

insert into carritocompras.CHojasxRollo (ID, no_hojas) values (1, 180),(2,200),(3,240),(4,320),(5,400),(6,500); 

insert into carritocompras.CPrivilegio_Empleado (ID, tipo_privilegio) values (1, "Empleado"), (2,"Gerente"), (3,"Admin");

insert into Mpapel values(1, "Papel Marca patito", 1);
insert into MPapel values(2, "Papel DOWNY para universidad",2);

insert into DPapel values(1,50.00,5,1,1,1,1,1,1);
insert into DPapel values(2, 499.99,2,1,2,2,2,3,6);

insert into Empleado values
(1,"Armando", "Jarillo", "Torres","1968-07-27","53521328","55667788","root","n0m3l0", 3),
(2,"Denilson", "Soto", "Luna","2003-01-07","12345678","19898989","UnSaludo","111111", 2),
(3,"Gerardo", "Rivera", "Y ya","1980-12-17","53521328","53456706","root","12345678", 1);

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
