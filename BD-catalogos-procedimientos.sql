-- MySQL Script generated by MySQL Workbench
-- Sun May 17 14:50:16 2020
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema carritocompras
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `carritocompras` ;

-- -----------------------------------------------------
-- Schema carritocompras
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `carritocompras` DEFAULT CHARACTER SET utf8 ;
USE `carritocompras`;

-- -----------------------------------------------------
-- Table `carritocompras`.`CMaterial`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`CMaterial` (
  `ID` INT NOT NULL,
  `Material` VARCHAR(20) NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `carritocompras`.`CTipos`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`CTipos` (
  `ID` INT NOT NULL,
  `Tipos` VARCHAR(20) NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `carritocompras`.`MPapel`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`MPapel` (
  `ID_mp` INT NOT NULL AUTO_INCREMENT,
  `Nombre_producto` VARCHAR(45) NULL,
  `id_DPapel` INT NOT NULL,
  PRIMARY KEY (`ID_mp`))
ENGINE = InnoDB;

CREATE INDEX `fk_DPapel_MPapel1_idx` ON `carritocompras`.`MPapel` (`id_DPapel` ASC);

-- -----------------------------------------------------
-- Table `carritocompras`.`CAromas`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`CAromas` (
  `ID` INT NOT NULL,
  `aroma` VARCHAR(20) NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `carritocompras`.`CRollosIncluidos`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`CRollosIncluidos` (
  `ID` INT NOT NULL,
  `rollos` INT NOT NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `carritocompras`.`CTipo_Hojas`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`CTipo_Hojas` (
  `ID` INT NOT NULL,
  `tipo_hojas` VARCHAR(10) NOT NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `carritocompras`.`CHojasxRollo`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`CHojasxRollo` (
  `ID` INT NOT NULL,
  `no_hojas` INT NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `carritocompras`.`DPapel`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`DPapel` (
  `ID_dp` INT NOT NULL auto_increment,
  `Precio` DOUBLE NOT NULL,
  `Stock` INT  NOT NULL,
  `CMaterial_ID` INT NOT NULL,
  `CTipos_ID` INT NOT NULL,
  `Aromas_ID` INT NOT NULL,
  `CRollosIncluidos_ID` INT NOT NULL,
  `CTipo_Hojas_ID` INT NOT NULL,
  `CHojasxRollo_ID` INT NOT NULL,
  PRIMARY KEY (`ID_dp`),
  CONSTRAINT `fk_Papel_CMaterial`
    FOREIGN KEY (`CMaterial_ID`)
    REFERENCES `carritocompras`.`CMaterial` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Papel_CTipos1`
    FOREIGN KEY (`CTipos_ID`)
    REFERENCES `carritocompras`.`CTipos` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_DPapel_MPapel1`
    FOREIGN KEY (`ID_dp`)
    REFERENCES `carritocompras`.`MPapel` (`id_DPapel`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_DPapel_Aromas1`
    FOREIGN KEY (`Aromas_ID`)
    REFERENCES `carritocompras`.`CAromas` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_DPapel_CRollosIncluidos1`
    FOREIGN KEY (`CRollosIncluidos_ID`)
    REFERENCES `carritocompras`.`CRollosIncluidos` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_DPapel_CTipo_Hojas1`
    FOREIGN KEY (`CTipo_Hojas_ID`)
    REFERENCES `carritocompras`.`CTipo_Hojas` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_DPapel_CHojasxRollo1`
    FOREIGN KEY (`CHojasxRollo_ID`)
    REFERENCES `carritocompras`.`CHojasxRollo` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_Papel_CMaterial_idx` ON `carritocompras`.`DPapel` (`CMaterial_ID` ASC); 

CREATE INDEX `fk_Papel_CTipos1_idx` ON `carritocompras`.`DPapel` (`CTipos_ID` ASC);


CREATE INDEX `fk_DPapel_Aromas1_idx` ON `carritocompras`.`DPapel` (`Aromas_ID` ASC);

CREATE INDEX `fk_DPapel_RollosIncluidos1_idx` ON `carritocompras`.`DPapel` (`CRollosIncluidos_ID` ASC);

CREATE INDEX `fk_DPapel_CTipo_Hojas1_idx` ON `carritocompras`.`DPapel` (`CTipo_Hojas_ID` ASC);

CREATE INDEX `fk_DPapel_CHojasxRollo1_idx` ON `carritocompras`.`DPapel` (`CHojasxRollo_ID` ASC);


-- -----------------------------------------------------
-- Table `carritocompras`.`Cliente`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`Cliente` (
  `ID_cli` INT NOT NULL auto_increment,
  `nombre_cli` varchar(45) not null,
  `appat_cli` VARCHAR(45) NOT NULL,
  `apmat_cli` VARCHAR(45) NOT NULL,
  `fecha_nacimiento_cli` DATE NULL,
  `username_cli` varchar(20) not null,
  `password_cli` varchar(20) not null,
  `cel_cli` INT NULL,
  `tel_cli` INT NULL,
  PRIMARY KEY (`ID_cli`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `carritocompras`.`CPrivilegio_Empleado`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`CPrivilegio_Empleado` (
  `ID` INT NOT NULL,
  `tipo_privilegio` VARCHAR(10) NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `carritocompras`.`Empleado`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`Empleado` (
  `ID_em` INT NOT NULL auto_increment,
  `nombre_em` VARCHAR(45) NOT NULL,
  `Appat_em` VARCHAR(45) NOT NULL,
  `Apmat_em` VARCHAR(45) NOT NULL,
  `fecha_nacimiento_em` DATE NULL,
  `cel_em` INT NULL,
  `tel_em` INT NULL,
  `username_em` varchar(20) not null,
  `password_em` varchar(20) not null,
  `CPrivilegio_Empleado_ID` INT NOT NULL,
  PRIMARY KEY (`ID_em`),
  CONSTRAINT `fk_Empleado_CPrivilegio_Empleado1`
    FOREIGN KEY (`CPrivilegio_Empleado_ID`)
    REFERENCES `carritocompras`.`CPrivilegio_Empleado` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_Empleado_CPrivilegio_Empleado1_idx` ON `carritocompras`.`Empleado` (`CPrivilegio_Empleado_ID` ASC) ;


-- -----------------------------------------------------
-- Table `carritocompras`.`MCarritoCompras`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`MCarritoCompras` (
  `ID` INT NOT NULL auto_increment,
  `orden` VARCHAR(45) NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`DCarritoDeCompras`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`DCarritoDeCompras` (
  `ID` INT NOT NULL,
  `total` DOUBLE NULL,
  `Subtotal` DOUBLE NULL,
  `fecha` DATETIME(4) NULL,
  `MPapel_ID` INT NOT NULL,
  `MCarritoCompras_ID` INT NOT NULL,
  PRIMARY KEY (`ID`),
  CONSTRAINT `fk_DCarritoDeCompras_MPapel1`
    FOREIGN KEY (`MPapel_ID`)
    REFERENCES `carritocompras`.`MPapel` (`ID_mp`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_DCarritoDeCompras_MCarritoCompras1`
    FOREIGN KEY (`MCarritoCompras_ID`)
    REFERENCES `carritocompras`.`MCarritoCompras` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_DCarritoDeCompras_MPapel1_idx` ON `carritocompras`.`DCarritoDeCompras` (`MPapel_ID` ASC);

CREATE INDEX `fk_DCarritoDeCompras_MCarritoCompras1_idx` ON `carritocompras`.`DCarritoDeCompras` (`MCarritoCompras_ID` ASC) ;


-- -----------------------------------------------------
-- Table `carritocompras`.`CompraCliente`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`CompraCliente` (
  `ID` INT NOT NULL,
  `Cliente_ID` INT NOT NULL,
  `DCarritoDeCompras_ID` INT NOT NULL,
  PRIMARY KEY (`ID`),
  CONSTRAINT `fk_CompraCliente_Cliente1`
    FOREIGN KEY (`Cliente_ID`)
    REFERENCES `mydb`.`Cliente` (`ID_cli`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_CompraCliente_DCarritoDeCompras1`
    FOREIGN KEY (`DCarritoDeCompras_ID`)
    REFERENCES `carritocompras`.`DCarritoDeCompras` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_CompraCliente_Cliente1_idx` ON `carritocompras`.`CompraCliente` (`Cliente_ID` ASC);

CREATE INDEX `fk_CompraCliente_DCarritoDeCompras1_idx` ON `carritocompras`.`CompraCliente` (`DCarritoDeCompras_ID` ASC) ;


-- -----------------------------------------------------
-- Table `carritocompras`.`COrdenServicio`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`COrdenServicio` (
  `ID` INT NOT NULL,
  `tipo_orden` VARCHAR(45) NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `carritocompras`.`DOrdenServicio`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`DOrdenServicio` (
  `ID` INT NOT NULL,
  `descripcion` LONGTEXT NULL,
  `Cliente_ID` INT NOT NULL,
  `fecha` DATE NULL,
  `Empleado_ID` INT NOT NULL,
  `COrdenServicio_ID` INT NOT NULL,
  PRIMARY KEY (`ID`),
  CONSTRAINT `fk_DOrdenServicio_Cliente1`
    FOREIGN KEY (`Cliente_ID`)
    REFERENCES `carritocompras`.`Cliente` (`ID_cli`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_DOrdenServicio_Empleado1`
    FOREIGN KEY (`Empleado_ID`)
    REFERENCES `carritocompras`.`Empleado` (`ID_em`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_DOrdenServicio_COrdenServicio1`
    FOREIGN KEY (`COrdenServicio_ID`)
    REFERENCES `carritocompras`.`COrdenServicio` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_DOrdenServicio_Cliente1_idx` ON `carritocompras`.`DOrdenServicio` (`Cliente_ID` ASC) ;

CREATE INDEX `fk_DOrdenServicio_Empleado1_idx` ON `carritocompras`.`DOrdenServicio` (`Empleado_ID` ASC);

CREATE INDEX `fk_DOrdenServicio_COrdenServicio1_idx` ON `carritocompras`.`DOrdenServicio` (`COrdenServicio_ID` ASC) ;


-- -----------------------------------------------------
-- Table `carritocompras`.`MOtrdenServicio`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `carritocompras`.`MOtrdenServicio` (
  `ID` INT NOT NULL,
  `DOrdenServicio_ID` INT NOT NULL,
  PRIMARY KEY (`ID`),
  CONSTRAINT `fk_MOtrdenServicio_DOrdenServicio1`
    FOREIGN KEY (`DOrdenServicio_ID`)
    REFERENCES `carritocompras`.`DOrdenServicio` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_MOtrdenServicio_DOrdenServicio1_idx` ON `carritocompras`.`MOtrdenServicio` (`DOrdenServicio_ID` ASC);

-- -----------------------------------------------------
-- llenando los valores de los catalogos y crear algunos procedimientos
-- -----------------------------------------------------------
insert into carritocompras.CMaterial (ID, Material) values(1, "CELULOSA"),(2,"FIBRA VEGETAL");

insert into carritocompras.CAromas (ID, Aroma) values(1, "SIN AROMA"),(2,"ALMENDRAS");

insert into carritocompras.CTipos (ID, Tipos) values(1, "Residencial"),(2,"Institucional");

insert into carritocompras.CRollosIncluidos (ID, rollos) values(1, 4), (2, 12), (3,18), (4,24), (5,32);

insert into carritocompras.CTipo_Hojas (ID, tipo_hojas) values(1, "Doble"),(2, "Triple"),(3,"Cuadruple");

insert into carritocompras.CHojasxRollo (ID, no_hojas) values (1, 180),(2,200),(3,240),(4,320),(5,400),(6,500); 

insert into carritocompras.CPrivilegio_Empleado (ID, tipo_privilegio) values (1, "Empleado"), (2,"Gerente"), (3,"Admin");

insert into Mpapel values(1, "Papel Marca patito", 1);
insert into MPapel values(2, "Papel DOWNY para universidad",2);

insert into DPapel values(1,50.00,5,1,1,1,1,1,1);
insert into DPapel values(2, 499.99,2,1,2,2,2,3,6);

insert into Empleado values
(1,"Armando", "Jarillo", "Torres","1968-07-27","53521328","55667788","root","n0m3l0", 3),
(2,"Denilson", "Soto", "Luna","2003-01-07","12345678","19898989","UnSaludo","111111", 2),
(3,"Gerardo", "Rivera", "Y ya","1980-12-17","53521328","53456706","root","12345678", 1);

DROP PROCEDURE IF EXISTS traducirIdesCatalogosCarrito;

CREATE PROCEDURE traducirIdesCatalogosCarrito(id_material int, id_tipos int, id_aroma int, id_rollos int, id_tipo_hojas int, id_hojas_rollos int)
	select carritocompras.CMaterial.material, carritocompras.CTipos.Tipos, carritocompras.CAromas.Aroma, carritocompras.CRollosIncluidos.rollos, carritocompras.CTipo_Hojas.tipo_hojas, carritocompras.CHojasxRollo.no_hojas 
    from carritocompras.CMaterial, carritocompras.CTipos, carritocompras.CAromas, carritocompras.CRollosIncluidos, carritocompras.CTipo_Hojas,carritocompras.CHojasxRollo
    where carritocompras.CMaterial.ID = id_material AND
		carritocompras.CTipos.ID = id_tipos AND
        carritocompras.CAromas.ID = id_aroma AND
        carritocompras.CRollosIncluidos.ID = id_rollos AND
        carritocompras.CTipo_Hojas.ID = id_tipo_hojas AND
        carritocompras.CHojasxRollo.ID = id_hojas_rollos;
    
        
drop procedure IF EXISTS traducirValoresCatalogosCarrito;

CREATE PROCEDURE traducirValoresCatalogosCarrito(mat varchar(20), tipo varchar(20), ar varchar(20), n_rollos int , tip_hojas varchar(10), hojas_rollos int)
	select carritocompras.CMaterial.ID, carritocompras.CTipos.ID, carritocompras.CAromas.ID, carritocompras.CRollosIncluidos.ID, carritocompras.CTipo_Hojas.ID, carritocompras.CHojasxRollo.ID 
    from carritocompras.CMaterial, carritocompras.CTipos, carritocompras.CAromas, carritocompras.CRollosIncluidos, carritocompras.CTipo_Hojas,carritocompras.CHojasxRollo
    where carritocompras.CMaterial.material = mat AND
		carritocompras.CTipos.Tipos = tipo AND
        carritocompras.CAromas.Aroma = ar AND
        carritocompras.CRollosIncluidos.rollos = n_rollos AND
        carritocompras.CTipo_Hojas.tipo_hojas = tip_hojas AND
        carritocompras.CHojasxRollo.no_hojas = hojas_rollos;

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
CREATE TABLE IF NOT EXISTS `carritocompras`.`DPapel` (   `ID_dp` INT NOT NULL auto_increment,   `Precio` DOUBLE NOT NULL,   `Stock` INT  NOT NULL,   `CMaterial_ID` INT NOT NULL,   `CTipos_ID` INT NOT NULL,   `Aromas_ID` INT NOT NULL,   `CRollosIncluidos_ID` INT NOT NULL,   `CTipo_Hojas_ID` INT NOT NULL,   `CHojasxRollo_ID` INT NOT NULL,   PRIMARY KEY (`ID_dp`),   CONSTRAINT `fk_Papel_CMaterial`     FOREIGN KEY (`CMaterial_ID`)     REFERENCES `carritocompras`.`CMaterial` (`ID`)     ON DELETE NO ACTION     ON UPDATE NO ACTION,   CONSTRAINT `fk_Papel_CTipos1`     FOREIGN KEY (`CTipos_ID`)     REFERENCES `carritocompras`.`CTipos` (`ID`)     ON DELETE NO ACTION     ON UPDATE NO ACTION,   CONSTRAINT `fk_DPapel_MPapel1`     FOREIGN KEY (`ID_dp`)     REFERENCES `carritocompras`.`MPapel` (`id_DPapel`)     ON DELETE NO ACTION     ON UPDATE NO ACTION,   CONSTRAINT `fk_DPapel_Aromas1`     FOREIGN KEY (`Aromas_ID`)     REFERENCES `carritocompras`.`CAromas` (`ID`)     ON DELETE NO ACTION     ON UPDATE NO ACTION,   CONSTRAINT `fk_DPapel_CRollosIncluidos1`     FOREIGN KEY (`CRollosIncluidos_ID`)     REFERENCES `carritocompras`.`CRollosIncluidos` (`ID`)     ON DELETE NO ACTION     ON UPDATE NO ACTION,   CONSTRAINT `fk_DPapel_CTipo_Hojas1`     FOREIGN KEY (`CTipo_Hojas_ID`)     REFERENCES `carritocompras`.`CTipo_Hojas` (`ID`)     ON DELETE NO ACTION     ON UPDATE NO ACTION,   CONSTRAINT `fk_DPapel_CHojasxRollo1`     FOREIGN KEY (`CHojasxRollo_ID`)     REFERENCES `carritocompras`.`CHojasxRollo` (`ID`)     ON DELETE NO ACTION     ON UPDATE NO ACTION) ENGINE = InnoDB
